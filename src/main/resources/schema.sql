DROP TABLE IF EXISTS GENRE CASCADE;
DROP TABLE IF EXISTS MPA CASCADE;
DROP TABLE IF EXISTS FILM CASCADE;
DROP TABLE IF EXISTS USERS CASCADE;
DROP TABLE IF EXISTS FRIENDSHIP CASCADE;
DROP TABLE IF EXISTS LIKES CASCADE;
DROP TABLE IF EXISTS GENRE_FILM CASCADE;

CREATE TABLE IF NOT EXISTS GENRE (
    	GENRE_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    	GENRE_NAME VARCHAR
    );

CREATE TABLE IF NOT EXISTS MPA (
    	MPA_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    	MPA_NAME VARCHAR
    );

CREATE TABLE IF NOT EXISTS FILM (
	FILM_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	MPA_ID INTEGER REFERENCES MPA(MPA_ID),
	FILM_RELEASE_DATE DATE,
    FILM_DURATION INTEGER,
    FILM_NAME VARCHAR NOT NULL,
    FILM_DESCRIPTION VARCHAR(200)
	);

	CREATE TABLE IF NOT EXISTS GENRE_FILM (
	    ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        GENRE_ID INTEGER REFERENCES GENRE(GENRE_ID),
        FILM_ID INTEGER REFERENCES FILM(FILM_ID)
        );

CREATE TABLE IF NOT EXISTS USERS (
        USER_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        USER_NAME VARCHAR,
        USER_EMAIL VARCHAR,
        USER_LOGIN VARCHAR,
        USER_BIRTHDAY DATE
        );

CREATE TABLE IF NOT EXISTS FRIENDSHIP (
        FRIENDSHIP_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    	FIRST_FRIEND_ID INTEGER,
    	SECOND_FRIEND_ID INTEGER
    );

    CREATE TABLE IF NOT EXISTS LIKES (
        	LIKE_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        	FILM_ID INTEGER REFERENCES FILM(FILM_ID),
        	USER_ID INTEGER REFERENCES USERS(USER_ID)
    );

       CREATE INDEX IF NOT EXISTS LIKES_INDEX ON LIKES (FILM_ID);
       CREATE INDEX IF NOT EXISTS LIKES_2_INDEX ON LIKES (USER_ID);
       CREATE INDEX IF NOT EXISTS FILM_INDEX ON FILM (MPA_ID);
       CREATE INDEX IF NOT EXISTS GENRE_INDEX ON GENRE_FILM (GENRE_ID);
       CREATE INDEX IF NOT EXISTS GENRE_INDEX_2 ON GENRE_FILM (FILM_ID);

       CREATE UNIQUE INDEX IF NOT EXISTS LIKE_ID_INDEX ON LIKES (LIKE_ID);
       CREATE UNIQUE INDEX IF NOT EXISTS FILM_ID_INDEX ON FILM (FILM_ID);
       CREATE UNIQUE INDEX IF NOT EXISTS USER_ID_INDEX ON USERS (USER_ID);
       CREATE UNIQUE INDEX IF NOT EXISTS FRIENDSHIP_ID_INDEX ON FRIENDSHIP (FRIENDSHIP_ID);
       CREATE UNIQUE INDEX IF NOT EXISTS GENRE_ID_INDEX ON GENRE (GENRE_ID);
       CREATE UNIQUE INDEX IF NOT EXISTS MPA_ID_INDEX ON MPA (MPA_ID);
       CREATE UNIQUE INDEX IF NOT EXISTS GENRE_FILM_ID ON GENRE_FILM(ID);













